Documentation of Current Issues

WebSocket Connection Problems:

Timeouts & Connection Errors:
Clients are experiencing timeouts when trying to establish a WebSocket connection.
Error messages observed on the client side include:
"Failed to connect to server on port 443 after [x] ms"
"WebSocket connection timed out"
Server logs sometimes record errors such as "ECONNREFUSED" or "Socket error" when a connection attempt fails.
Unexpected Disconnections:
Even after a successful connection, some clients are randomly disconnected.
Client-side logs display messages like "WebSocket disconnected unexpectedly" or "Connection lost."
There are indications that network configurations (firewalls/proxies) or server initialization issues might be affecting stability.
Authentication System Issues:

Login Failures:
Some users report that they are unable to log in despite using valid credentials.
The client sometimes displays messages like "Invalid username or password," even when the credentials are correct.
Stale Session Data & Updated User Details:
When users update their CliQ settings (for example, switching to a phone number), the updated information (such as cliqNumber) is correctly saved to the database (as seen in the update logs).
However, subsequent requests (e.g., during trade creation) still show the old or null values for these fields in req.user.
Logs indicate that after calling req.login(updatedUser, callback) in the /api/user/settings/cliq route, the session still does not reflect the updated phone number.
This suggests an issue with either the session refresh logic or with the Passport deserializeUser function not retrieving the latest data.
Observations from Logs and Errors:

On the client side, error messages related to WebSocket timeouts and disconnections are consistently logged.
Server-side logs in the authentication routes (and in auth.ts) indicate that while user updates are processed (e.g., new cliqNumber values are logged), the session object (req.user) does not get updated accordingly.
Debug logs from the /api/trade endpoint show that when a sell order is submitted, req.user.cliqNumber remains null even though the updated user object (fetched from storage) contains the correct value.
This documentation should help us understand the scope of the problems with WebSocket connections and authentication. It will also guide us in developing a troubleshooting plan to:

Investigate network configurations and server initialization for WebSocket stability.
Examine Passportâ€™s session management and deserializeUser function to ensure that updated user details are correctly loaded into req.user.
Determine whether to temporarily simplify the authentication mechanism to stabilize sessions before adding more complex WebSocket features.
Please review this documentation and let me know if we should proceed with a detailed troubleshooting plan based on these observations.